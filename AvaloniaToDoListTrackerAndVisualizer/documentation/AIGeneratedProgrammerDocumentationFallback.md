# Programmer Documentation: TodoListSolution (Fallback, AI‑generated)

> **Disclaimer:** this documentation was generated by an AI to act as a
> fallback when no manually authored documentation is available. It
> should be reviewed and extended by the original developers before
> relying on it.

## Overview

`TodoListSolution` is a cross‑platform to‑do list tracker and
visualizer built with **Avalonia UI** and the **CommunityToolkit.MVVM**
framework. The solution is organized around the **Model--View--ViewModel
(MVVM)** pattern:

-   **Models** represent data (tasks, subtasks, groups, sessions, user
    settings). They expose observable properties and support
    serialization.
-   **ViewModels** expose model data and commands to the UI. They
    implement navigation, editing and filtering logic while remaining
    UI‑agnostic.
-   **Views** (Axaml files) describe the UI and bind to ViewModel
    properties and commands.
-   **Services/Providers** encapsulate persistence and localization
    logic.

The application allows users to create tasks with subtasks, deadlines
and prerequisites, assign them to groups with colors, start work
sessions (including a simple pomodoro timer), and view statistics such
as total time worked or average work per day.

## Project structure

    TodoListSolution/
    ├── AvaloniaToDoListTrackerAndVisualizer/
    │   ├── Assets/                # icons and static resources
    │   ├── Lang/                  # resource files for localization (en‑US, cs‑CZ)
    │   ├── documentation/         # user documentation stub (not yet used)
    │   ├── src/
    │   │   ├── Converters/        # value converters for Avalonia bindings
    │   │   ├── Extensions/        # helper extension methods
    │   │   ├── Messages/          # weak‑reference messages for MVVM communication
    │   │   ├── Models/            # core data models and save‑able types
    │   │   ├── Providers/         # localization provider
    │   │   ├── Services/          # file persistence service
    │   │   ├── Styles/            # Axaml style definitions
    │   │   ├── ViewModels/        # all view models, grouped by purpose
    │   │   ├── Views/             # Axaml files and code‑behind for UI
    │   │   └── Wrappers/          # collection wrapper tracking child changes
    │   ├── App.axaml              # application XAML and resources
    │   ├── App.axaml.cs           # application start‑up logic
    │   ├── Program.cs             # entry point
    │   └── ViewLocator.cs         # resolves view models to views
    └── TodoListSolution.sln       # solution file

## Application entry and configuration

The application starts in `Program.cs`, which builds an Avalonia
`AppBuilder`, detects the platform and starts the main window
(`MainWindow`) using classic desktop lifetime. The `App` class (defined
in `App.axaml.cs`) registers services into a dependency‑injection
container and constructs the **MainWindowViewModel**. Data validation
via `DataAnnotations` is disabled; validation is handled in models.

### Dependency injection and services

`App` registers an implementation of **ITaskApplicationFileService**
(see the [File service](#file-service) section) and the
**MainWindowViewModel** in the service collection. This ensures that the
view model is created once and reused. The `LocalizationProvider` is
created inside the view model and exposed to sub‑components.

## Models

### Task and subtask models

Tasks are defined in `TaskModels.cs` and derive from `TaskBaseModel`
(observable with data‑annotation validation). A **TaskModel** has:

-   A **GUID** `Id` for identification and persistence.
-   Optional **Group** assignment (color + name).
-   Optional **BeginDate**, **SoftDeadline** and **HardDeadline**.
-   **TimeSpent** and optional **TimeExpected** for planning.
-   **Subtasks** (`ObservableChildrenCollectionWrapper<SubTaskModel>`):
    only exposed as read‑only to enforce use of `AddSubtask` /
    `RemoveSubtask` methods.
-   **Prerequisites** (other tasks) and **PrecedingEvents** (external
    events) stored in wrappers.
-   Computed property **Ready**: a task is ready only when all
    prerequisites and events are completed and the current date is after
    the begin
    date[\[1\]](../src/Models/Items/TaskModels.cs#:~:text=%2F%2F%2F%20,IsCompleted%29%20%26%26%20%21IsCompleted%20%26%26%20AfterBeginDate).
-   **CanChangeCompleteness**: completion can only toggle if the task is
    ready or already
    completed[\[2\]](../src/Models/Items/TaskModels.cs#:~:text=%2F%2F%2F%20,).

`SubTaskModel` inherits from `TaskBaseModel`. It always permits
completion and has only a name, description and completion status.

### Group model

`Group.cs` defines a group of tasks with an **Id**, **ARGB color** and
**GroupName**. Groups support two constructors (for new and existing
groups) and use `ObservableValidator` to expose properties.

### Session management

A session represents a contiguous block of work and may contain multiple
**SessionParts**. `SessionPart` is an immutable record storing
`PartStart` and `PartEnd`; it computes its `Duration`. `Session` holds a
collection of finished parts and manages a single **RunningSessionPart**
at a
time[\[3\]](../src/Models/SessionManagement/Session.cs#L35-L42).
The session API allows:

-   `AddPart(SessionPart part)` -- add an arbitrary part.
-   `Start()` -- begin a new running part and automatically cancel any
    previous running
    part[\[4\]](../src/Models/SessionManagement/Session.cs#L120-L128).
-   `TotalSessionTime()` -- sum durations of finished parts and include
    the running part\'s elapsed
    time[\[5\]](../src/Models/SessionManagement/Session.cs#L131-L141).
-   `RunningSessionPart.End()` -- finish a running part and store it;
    returns the finished
    `SessionPart`[\[6\]](../src/Models/SessionManagement/Session.cs#L205-L222).
-   `RunningSessionPart.Cancel()` -- cancel a running part so its
    duration is
    zero[\[7\]](../src/Models/SessionManagement/Session.cs#L226-L236).

`SessionStatistics` provides static methods to compute total time
worked, worked today, most productive day and average time per day
across sessions.

### User settings

`UserSettings` currently only contains a **DailyGoal** (`TimeSpan`). The
profile page can edit this goal.

### Persistence -- TaskApplicationState

The application persists data via **TaskApplicationState**, which holds
lists of tasks, groups, sessions and user settings. To recreate runtime
objects from save‑able representations (`SaveAbleTask` and
`SaveAbleGroup`), it uses `CreateApplicationStateFromSaveAble`. This
method constructs a `Group` dictionary and converts tasks to models,
linking group IDs and prerequisite IDs back to
objects[\[8\]](../src/Models/TaskApplicationState.cs#:~:text=public%20static%20TaskApplicationState%20CreateApplicationStateFromSaveAble%28IEnumerable,Values%2C%20sessions%2C%20userSettings%29%3B).

## File service

`TaskApplicationFileService` implements **ITaskApplicationFileService**.
It saves tasks, groups, sessions and settings to JSON files in
`%APPDATA%/ToDoListTrackerAndVisualizer` and loads them on startup. The
service serializes tasks and groups through their save‑able types and
uses `JsonSerializer` for sessions and user settings. When saving, it
creates the directory and writes separate JSON files for tasks, groups,
sessions and
settings[\[9\]](../src/Services/ITaskApplicationFileService.cs#:~:text=%2F%2F%2F%20,CreateDirectory%28_folderPath).
When loading, it reads each file, deserializes the data and calls
`TaskApplicationState.CreateApplicationStateFromSaveAble` to rebuild the
runtime
objects[\[10\]](../src/Services/ITaskApplicationFileService.cs#:~:text=public%20async%20Task,SaveAbleTask%3E%3E%28saveAbleTasksFile%29).
If files are missing, it returns `null` and data is reset.

## Providers

### LocalizationProvider

`LocalizationProvider` exposes strongly‑typed string properties loaded
from resource files (`Lang/Resources.*.resx`). Changing the culture via
`SetCulture` updates `Resources.Culture` and raises property‑changed
notifications so that bound UI updates
automatically[\[11\]](../src/Providers/LocalizationProvider.cs#:~:text=%2F%2F%2F%20,Empty).
It should be used as a singleton within the application. Strings such as
button texts, labels and dialog captions are defined here.

## Converters and extensions

-   **AvaloniaColorToArgbConverter / ColorToBrushConverter /
    EnumBoolConverter / NullToDefaultConverter** -- used for XAML
    bindings to convert colors, enums and null values.
-   **ObservableCollectionExtension.AddIfNotExists** -- extension method
    to add an item only if the collection does not already contain it.

## Collection wrapper

`ObservableChildrenCollectionWrapper<T>` wraps an
`ObservableCollection<T>` and listens for property changes on its items.
It rewires subscriptions when items are added, removed or replaced and
exposes a `ChildrenPropertyChanged`
event[\[12\]](../src/Wrappers/ObservableChildrenCollectionWrapper.cs#:~:text=%2F%2F%2F%20,).
This wrapper is used by models and view models to track when a child
property (like `IsCompleted`) changes, enabling filtered collections and
UI updates.

## Messaging

The project uses **CommunityToolkit.Mvvm.Messaging** to decouple
components. Messages include:

-   **EditTaskMessage / EditSubTaskMessage / EditTaskInSessionMessage**
    -- open editing dialogs.
-   **DeleteTaskViewModelRequest** -- request to delete a task.
-   **OpenGroupSelectionRequest / SessionTaskSelectionRequest /
    PrerequisiteTaskSelectionRequest** -- asynchronous requests
    returning user selections.
-   **StartSessionMessage / SetupTimerRequest** -- open the session
    window or timer settings.
-   **Close...Message** types -- signal completion or cancellation of
    dialogs.
-   **SessionDeletionRequest / CloseSessionDeletionMessage** -- confirm
    deletion of all sessions.

Messages are sent using `WeakReferenceMessenger.Default.Send(...)`,
ensuring that the sender does not hold strong references to recipients.

## ViewModels

### MainWindowViewModel

The **MainWindowViewModel** orchestrates the application. It holds the
global collections **Tasks**, **Groups**, **Sessions** and
**UserSettings**, and exposes a **CurrentPage** property bound to the
content frame. It creates instances of **HomeViewModel**,
**SettingsViewModel**, **ProfileViewModel** and **TreeViewModel**.
Navigation commands (GoHome, GoProfile, etc.) switch `CurrentPage`.
`LoadFiles()` clears existing data, invokes the file service to load
persisted state and populates
collections[\[13\]](../src/ViewModels/MainWindowViewModel.cs#:~:text=%2F%2F%2F%20,Zero).
`SaveFiles()` constructs a `TaskApplicationState` and hands it to the
file
service[\[14\]](../src/ViewModels/MainWindowViewModel.cs#:~:text=%2F%2F%2F%20,Collection%2C%20Sessions%2C%20UserSettings).

### TaskListViewModel

`TaskListViewModel` exposes:

-   **AllTasks** -- an observable collection wrapper containing
    **TaskViewModel** instances.
-   **ReadyTasks / CompletedTasks** -- read‑only collections
    automatically filtered based on task readiness and
    completion[\[15\]](../src/ViewModels/ItemViewModels/TaskListViewModel.cs#:~:text=%2F%2F%2F%20Registered%20tasks%20which%20fall,TaskViewModel%3E%20ReadyTasks%20%7B%20get%3B).
-   When a task's `IsCompleted` or `Ready` property changes, the view
    model updates the corresponding filtered
    collection[\[16\]](../src/ViewModels/ItemViewModels/TaskListViewModel.cs#:~:text=%2F%2F%20If%20child%20IsCompleted%20changed,_completedTasks.Remove%28taskViewModel%29%3B%20%7D).
    It also registers for `DeleteTaskViewModelRequest` messages to
    remove a task from the
    list.[\[17\]](../src/ViewModels/ItemViewModels/TaskListViewModel.cs#:~:text=WeakReferenceMessenger.Default.Register,m.TaskToDelete.Dispose%28%29%3B%20%7D).

### TaskViewModel

`TaskViewModel` wraps a **TaskModel** and exposes UI‑friendly properties
such as:

-   **CompleteButtonColor / CompleteButtonText** -- computed based on
    completion status.
-   **DeadlineInfoBackgroundColor / DeadlineInfoText** -- color and text
    based on begin and deadline dates.
-   **TimeLeftText** -- formatted time spent vs expected.
-   **GroupText / GroupColor** -- derived from the assigned group.
-   **ActionButtonMode** -- toggled between "Details" and "Delete";
    affects button text and color.

It uses a **DynamicData** pipeline to convert subtasks into
`SubTaskViewModel` instances and binds them to `SubTasksViewModels`. It
listens to property changes on the underlying `TaskModel` and updates
its own properties
accordingly.[\[18\]](../src/ViewModels/ItemViewModels/TaskViewModel.cs#:~:text=%2F%2F%2F%20,FromUInt32%28argb%29%29%3B).

### HomeViewModel

`HomeViewModel` presents the list of tasks on the home page. It holds
the current list (Ready, Completed or All) and updates button
backgrounds accordingly. Commands allow filtering by ready/completed/all
tasks, assigning a group to a task via a selection dialog, toggling
action mode (details vs delete) for all tasks, and invoking the edit or
delete action on a selected
task[\[19\]](../src/ViewModels/HomeViewModel.cs#:~:text=private%20void%20updateCurrentTaskList%28%29%20,AllButtonBackground%29%29%3B).

### Edit view models

-   **TaskEditViewModel** manages creation and editing of tasks. It
    exposes pickers for expected hours and minutes, adds and removes
    subtasks, manages prerequisites selection and saves the task. It
    also ensures that a task cannot be saved if its name is
    empty[\[20\]](../src/ViewModels/EditViewModels/TaskEditViewModel.cs#:~:text=public%20bool%20CanCloseAndSave%20,).
-   **SubTaskEditViewModel** manages editing of a subtask and prevents
    closing the dialog if the subtask name is
    empty[\[21\]](../src/ViewModels/EditViewModels/SubTaskEditViewModel.cs#:~:text=%2F%2F%20If%20name%20was%20changed%2C,PropertyChanged%20%2B%3D%20CheckIfCanExistChanged%3B).

### ProfileViewModel

The profile page shows simple statistics and daily goal settings. It
uses `SessionStatistics` to compute total time worked, time worked
today, most productive day and average per day. The daily goal (hours
and minutes) binds to **UserSettings.DailyGoal**; changing the goal
updates the settings and the "goal achieved/not yet achieved"
message[\[22\]](../src/ViewModels/ProfileViewModel.cs#:~:text=%2F%2F%2F%20,).
The view model can clear all sessions after
confirmation[\[23\]](../src/ViewModels/ProfileViewModel.cs#:~:text=%2F%2F%2F%20First%2C%20show%20dialog%2C%20whether,Sessions.Clear%28%29%3B%20%7D).

### Other view models

-   **GroupListViewModel** -- holds the collection of all groups.
-   **SubTaskViewModel** -- wraps a subtask and exposes
    complete/un‑complete commands and editing
    command[\[24\]](../src/ViewModels/ItemViewModels/SubTaskViewModel.cs#:~:text=%2F%2F%2F%20,OnPropertyChanged%28e.PropertyName%29%3B).
-   **SettingsViewModel / TreeViewModel** -- currently empty
    placeholders for future features.
-   **SessionDeletionViewModel** -- used by the confirmation dialog to
    send a yes/no
    message[\[25\]](../src/ViewModels/ConfirmationDialogsViewModels/SessionDeletionViewModel.cs#:~:text=%5BRelayCommand%5D%20private%20void%20Yes%28%29%20,Send%28new%20CloseSessionDeletionMessage%28true%29%29%3B).

## Views

Views are defined in `.axaml` files under `src/Views`. Key views
include:

-   **MainWindow.axaml** -- defines the overall layout with a navigation
    menu on the left and a content frame on the right. It binds to
    `MainWindowViewModel` commands and `CurrentPage`.
-   **HomeView.axaml** -- displays tasks in a list with filtering
    buttons and action buttons.
-   **TaskEditView.axaml / SubTaskEditView.axaml** -- dialog windows for
    editing tasks and subtasks.
-   **SessionDeletionDialog.axaml** -- confirmation dialog for deleting
    all sessions.

All views use bindings to the corresponding view model properties and
commands and employ converters and styles defined in `src/Converters`
and `src/Styles`.

## Patterns and best practices

-   **MVVM with CommunityToolkit** -- models are observable and
    validated; view models use `[ObservableProperty]`, `[RelayCommand]`
    and `[NotifyPropertyChangedFor]` to reduce boilerplate.
-   **WeakReferenceMessenger** -- decouples components; dialogs and
    pages communicate by sending and responding to messages instead of
    direct method calls.
-   **DynamicData** -- used in `TaskViewModel` to transform subtask
    collections into view models and keep them synchronized.
-   **ObservableChildrenCollectionWrapper** -- ensures that collection
    changes and child property changes propagate correctly.
-   **Dependency injection** -- services (e.g., file service) and view
    models are registered at startup and injected where needed.
-   **Localization** -- string resources are centralized and culture can
    be changed at runtime.

## Extending the project

Developers may extend this project by:

-   Implementing **SettingsViewModel** and **TreeViewModel** to add
    settings pages and a hierarchical view of tasks.
-   Enhancing **ProfileViewModel** with additional statistics or graphs.
-   Adding more **TaskModel** validation (e.g., ensuring deadlines are
    after the begin date) and implementing a DAG check for
    prerequisites.
-   Implementing a proper pomodoro timer UI and additional session
    analysis.
-   Adding error dialogs and recovery when loading/saving fails (noted
    as TODOs).

## Conclusion

This project demonstrates a clean MVVM architecture using Avalonia UI
and CommunityToolkit. Models are fully observable and decoupled from the
UI, while view models encapsulate presentation logic and use a message
bus for interaction. Persistence is handled via a simple JSON file
service. The current codebase is well organized and ready for
extensions, though several areas (settings, tree view, advanced
statistics) are intentionally left blank for future development.
